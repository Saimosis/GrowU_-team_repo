<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/css/exerciselog.css" />
  </head>

  <body>
    <div id="header">Exercise Log</div>

  <div class="form-wrapper">
  <h2>Exercises</h2>
    <form id="reps-form" class="exercise-form">
      <input placeholder="Exercise Type" name="reps-type" id="reps-type-input" type="text" />
      <input placeholder="Repetitions" name="reps" id="reps-input" type="number" />
      <button type="submit">Submit</button>
    </form>
    <br>
  </div>
  
<div class="form-wrapper">
  <h2>Runs</h2>
    <form id="duration-form" class="exercise-form">
      <input placeholder="Exercise Type"  name="duration-type" id="duration-type-input" type="text" />
      <input placeholder="Duration" name="duration" id="duration-input" type="number" />
      <button type="submit">Submit</button>
    </form>
    <br>
</div>

    <script>

      if (localStorage.getItem("loggedIn") === "false") {
        alert("Please log in before accessing this page");
        window.location.href = "/login";
      }


      document
        .getElementById("duration-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const dType = document.getElementById("duration-type-input").value;
          const duration = document.getElementById("duration-input").value;
          const currentUser = JSON.parse(localStorage.getItem("currentUser"));
          try {
            const response = await fetch(`/d-exercise-submit`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ dType, duration, currentUser }),
            });
            console.log(response);

            if (!response.ok) {
              throw new Error("response no good");
            }

            const user = await response.json();

            localStorage.setItem("currentUser", JSON.stringify(user));
            console.log(localStorage.getItem("currentUser"));
            window.location.href = "/profile";
          } catch (error) {
            alert("Exercie Entry Failed: " + error.message);
          }
        });

      document
        .getElementById("reps-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const rType = document.getElementById("reps-type-input").value;
          const reps = document.getElementById("reps-input").value;
          const currentUser = JSON.parse(localStorage.getItem("currentUser"));
          try {
            const response = await fetch(
              `/r-exercise-submit`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ rType, reps, currentUser }),
              }
            );

            if (!response.ok) {
              throw new Error("Error");
            }

            const user = await response.json();

            localStorage.setItem("currentUser", JSON.stringify(user));
            console.log(localStorage.getItem("currentUser"));
            window.location.href = "/profile";
          } catch (error) {
            alert("Exercise Entry Failed: " + error.message);
          }
        });
    </script>
  </body>
</html>
